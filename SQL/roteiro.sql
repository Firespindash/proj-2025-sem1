-- ATENÇÃO: Por algum motivo não funciona no Oracle 19c (HR), só 21c e 23c
CREATE TABLE CONTRATANTES (
    CNPJ NUMBER(13),
    TELEFONE NUMBER(11),
    EMAIL VARCHAR2(128),
    NM_CONTRATANTE VARCHAR2(128) NOT NULL,
    LOCALIDADE VARCHAR2(60) NOT NULL,
    NOME VARCHAR2(128) NOT NULL,

    CONSTRAINT CONT_CNPJ_PK PRIMARY KEY (CNPJ)
);

CREATE TABLE EMPRESA (
    CNPJ NUMBER(14),
    NOME VARCHAR2(20) NOT NULL,
    EMAIL VARCHAR2(128) NOT NULL,
    TELEFONE NUMBER(12) NOT NULL,
    ENDERECO VARCHAR2(40) NOT NULL,
    CONTRATANTE NUMBER(13) NOT NULL,

    CONSTRAINT EMP_CNPJ_PK PRIMARY KEY (CNPJ),
    CONSTRAINT EMP_CONT_FK FOREIGN KEY (CONTRATANTE) REFERENCES CONTRATANTES(CNPJ),
    CONSTRAINT EMP_NOME_UU UNIQUE (NOME)
);

CREATE TABLE PRODUTO (
    ID_PRODUTO NUMBER(7),
    NOME VARCHAR2(80) NOT NULL,
    VALIDADE_PADRAO NUMBER(5), -- Validade em dias
    QNTD_PADRAO NUMBER(6) NOT NULL,
    NV_PRIORIDADE NUMBER(2) NOT NULL,
    DT_ADD DATE NOT NULL,

    CONSTRAINT PROD_IDPROD_PK PRIMARY KEY (ID_PRODUTO),
    CONSTRAINT PROD_NM_UU UNIQUE (NOME),
    CONSTRAINT PROD_NVACESS_CHK CHECK (NV_PRIORIDADE IN (1, 2, 3))
);

CREATE TABLE USUARIO (
    ID_USUARIO NUMBER(4),
    NOME VARCHAR2(128) NOT NULL,
    EMAIL VARCHAR2(128) NOT NULL,
    SENHA VARCHAR2(128) NOT NULL,
    NV_ACESSO NUMBER(2) NOT NULL,

    CONSTRAINT USU_IDUS_PK PRIMARY KEY (ID_USUARIO)
);

CREATE TABLE ENTRADA (
    ID NUMBER(4),
    NOME VARCHAR2(80) NOT NULL,
    DT_ADD DATE NOT NULL,
    N_LOTE NUMBER(10),
    VALIDADE DATE,
    QNTD NUMBER(5) NOT NULL,
    NV_PRI NUMBER(2) NOT NULL,

    CONSTRAINT ENT_ID_PK PRIMARY KEY (ID)
);

CREATE TABLE PROD_ENTR (
    ID_PRODUTO NUMBER(7),
    ID_ENTR NUMBER(4),

    CONSTRAINT PROD_ENTR_IDPROD_FK FOREIGN KEY (ID_PRODUTO) REFERENCES PRODUTO(ID_PRODUTO),
    CONSTRAINT PROD_ENTR_IDENTR_FK FOREIGN KEY (ID_ENTR) REFERENCES ENTRADA(ID),
    CONSTRAINT PROD_ENTR_PK PRIMARY KEY (ID_PRODUTO, ID_ENTR)
);

CREATE TABLE PROD_EMP (
    CNPJ NUMBER(14),
    ID_PRODUTO NUMBER(7),

    CONSTRAINT PROD_EMP_IDPROD_FK FOREIGN KEY (ID_PRODUTO) REFERENCES PRODUTO(ID_PRODUTO),
    CONSTRAINT PROD_EMP_CNPJ_FK FOREIGN KEY (CNPJ) REFERENCES EMPRESA(CNPJ),
    CONSTRAINT PROD_EMP_PK PRIMARY KEY (ID_PRODUTO, CNPJ)
);

CREATE TABLE ALPHATECH (
    CNPJ NUMBER(13),
    LOCALIDADE VARCHAR2(256) NOT NULL,
    CO VARCHAR2(20) NOT NULL,
    CONTATO VARCHAR2(25) NOT NULL,

    CONSTRAINT ALPH_CNPJ_PK PRIMARY KEY (CNPJ)
);

CREATE TABLE CONTAS (
    DANFE NUMBER(30), -- Se mudar pra 44, o número mais aproximado ele dá erro aparentemente
    DT_VENCIMENTO DATE,
    DT_EMISSAO DATE,
    EMISSOR VARCHAR2(60),
    VALOR NUMBER(10,2),
    CNPJ NUMBER(13),

    CONSTRAINT CONT_CNPJ_FK FOREIGN KEY (CNPJ) REFERENCES ALPHATECH(CNPJ)
);

CREATE TABLE DEPARTAMENTOS (
    DEP_ID NUMBER(7),
    NOME_DEPT CHAR(15),
    CNPJ NUMBER(13),

    CONSTRAINT DEPT_DEPID_PK PRIMARY KEY (DEP_ID),
    CONSTRAINT DEPT_CNPJ_FK FOREIGN KEY (CNPJ) REFERENCES ALPHATECH(CNPJ)
);

CREATE TABLE ALPHA_CONTR (
    CNPJ_A NUMBER(13),
    CNPJ_C NUMBER(13),

    CONSTRAINT ALPHCONTR_CNPJA_FK FOREIGN KEY (CNPJ_A) REFERENCES ALPHATECH(CNPJ),
    CONSTRAINT ALPHCONTR_CNPJC_FK FOREIGN KEY (CNPJ_C) REFERENCES CONTRATANTES(CNPJ),
    CONSTRAINT ANPJA_CNPJC_PK PRIMARY KEY (CNPJ_A, CNPJ_C)
);

CREATE TABLE CONT_USU (
    CNPJ NUMBER(13),
    ID_USU NUMBER(4),

    CONSTRAINT USUCONTR_CNPJ_FK FOREIGN KEY (CNPJ) REFERENCES CONTRATANTES(CNPJ),
    CONSTRAINT USUCONTR_ID_USU_FK FOREIGN KEY (ID_USU) REFERENCES USUARIO(ID_USUARIO),
    CONSTRAINT IDUSU_CNPJ_PK PRIMARY KEY (CNPJ, ID_USU)
);

CREATE TABLE EMP_USU (
    CNPJ NUMBER(14),
    ID_USU NUMBER(4),

    CONSTRAINT USUEMPR_CNPJ_FK FOREIGN KEY (CNPJ) REFERENCES EMPRESA(CNPJ),
    CONSTRAINT USUEMPR_ID_USU_FK FOREIGN KEY (ID_USU) REFERENCES USUARIO(ID_USUARIO),
    CONSTRAINT IDUSU_EMPR_PK PRIMARY KEY (CNPJ, ID_USU)
);

INSERT INTO CONTRATANTES VALUES (1234567890000, 11911111111, 'administracao@vocesa.com', 'Você SA.', 'São Paulo', 'Carlos Duarte');
INSERT INTO CONTRATANTES VALUES (1234567891045, 11922222222, 'cliente1@email.com', 'Bugiganga Transportadora', 'Campinas', 'Renata Lopes');
INSERT INTO CONTRATANTES VALUES (1234567890001, 11933333333, 'cliente2@email.com', 'Guarda-chuva Holding', 'Santos', 'Tiago Nunes');

INSERT INTO EMPRESA VALUES (12345678900001, 'Você SA.', 'contato@vocesa.com', 11999999999, 'Av. Principal, 100', 1234567890000);
INSERT INTO EMPRESA VALUES (12345678900002, 'TechTech', 'contato@techtech.com', 22999999999, 'Av. do Pesquisador, 200', 1234567890001);
INSERT INTO EMPRESA VALUES (12345678900003, 'Armazéns Belo Visto', 'contato@abv.com', 33999999999, 'Av. Armênia, 300', 1234567890001);

INSERT INTO PRODUTO VALUES (10, 'Servidor Dell R740', 3650, 5, 1, SYSDATE);
INSERT INTO PRODUTO VALUES (20, 'Notebook Lenovo ThinkPad', 1292, 10, 2, SYSDATE);
INSERT INTO PRODUTO VALUES (30, 'Switch Cisco SG350', 1385, 7, 3, SYSDATE);

INSERT INTO USUARIO VALUES (101, 'joão', 'joao@vocesa.com', 'senha123', 1);
INSERT INTO USUARIO VALUES (102, 'adm01', 'adm1@techtech.com', 'senha456', 2);
INSERT INTO USUARIO VALUES (103, 'beepador3', 'lidertecnico@abv.com', 'senha789', 3);

INSERT INTO ENTRADA VALUES (1001, 'Chegada de servidores', SYSDATE, 101, TO_DATE('2035-05-28', 'YYYY-MM-DD'), 5, 1);
INSERT INTO ENTRADA VALUES (1002, 'Entrega de notebooks', SYSDATE, 102, TO_DATE('2028-02-10', 'YYYY-MM-DD'), 10, 2);
INSERT INTO ENTRADA VALUES (1003, 'Instalação de switches', SYSDATE, 103, TO_DATE('2033-04-30', 'YYYY-MM-DD'), 7, 3);

INSERT INTO PROD_ENTR VALUES (10, 1001);
INSERT INTO PROD_ENTR VALUES (20, 1002);
INSERT INTO PROD_ENTR VALUES (30, 1003);

INSERT INTO PROD_EMP VALUES (12345678900001, 10);
INSERT INTO PROD_EMP VALUES (12345678900002, 20);
INSERT INTO PROD_EMP VALUES (12345678900003, 30);

INSERT INTO ALPHATECH VALUES (1234567890400, 'Av. Marquês de São Vicente XXX, Barra Funda, São Paulo', 'CO01', 'matriz@alphatech.com');
INSERT INTO ALPHATECH VALUES (1234567890500, 'Av. Braz Leme XXXX, Santana, São Paulo', 'CO02', 'filial01@alphatech.com');
INSERT INTO ALPHATECH VALUES (1234567890600, 'Av. Engenheiro Luís Carlos Berrini XXXX, Itaim Bibi, São Paulo', 'CO03', 'filial02@alphatech.com');

INSERT INTO CONTAS VALUES (12345678901234561034, TO_DATE('2025-06-01','YYYY-MM-DD'), TO_DATE('2025-03-01','YYYY-MM-DD'), 'TechFornecedor LTDA', 3500.00, 1234567890600);
INSERT INTO CONTAS VALUES (12345678901234561285, TO_DATE('2025-07-01','YYYY-MM-DD'), TO_DATE('2025-04-01','YYYY-MM-DD'), 'InfoTec Soluções', 4200.00, 1234567890500);
INSERT INTO CONTAS VALUES (12345678901234561396, TO_DATE('2025-08-01','YYYY-MM-DD'), TO_DATE('2025-05-01','YYYY-MM-DD'), 'Digital Master', 3900.00, 1234567890400);

INSERT INTO DEPARTAMENTOS VALUES (1, 'MARKETING', 1234567890400);
INSERT INTO DEPARTAMENTOS VALUES (2, 'PROGRAMAÇÃO', 1234567890400);
INSERT INTO DEPARTAMENTOS VALUES (3, 'INFRA/DBA', 1234567890600);

INSERT INTO ALPHA_CONTR VALUES (1234567890400, 1234567890000);
INSERT INTO ALPHA_CONTR VALUES (1234567890400, 1234567890001);
INSERT INTO ALPHA_CONTR VALUES (1234567890400, 1234567891045);

INSERT INTO CONT_USU VALUES (1234567890000, 101);
INSERT INTO CONT_USU VALUES (1234567890001, 102);
INSERT INTO CONT_USU VALUES (1234567890001, 103);

INSERT INTO EMP_USU VALUES (12345678900001, 101);
INSERT INTO EMP_USU VALUES (12345678900002, 102);
INSERT INTO EMP_USU VALUES (12345678900003, 103);